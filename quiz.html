<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8">
    <title>ÙˆØ£Ø®Ø± Ù…ØªØ´Ø§Ø¨Ù‡Ø§Øª</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            font-family: "Cairo", Arial, sans-serif;
            direction: rtl;
            text-align: right;
            padding: 20px;
            background-color: #f8f9fa;
        }

        .result {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, .1);
            margin-top: 15px;
        }

        button {
            padding: 8px 15px;
            border-radius: 6px;
            border: none;
            background: #2e86de;
            color: white;
            cursor: pointer;
        }
        
   
        button:hover {
            background: #1b4f72;
        }.surah-box {
    background: white;
    border-radius: 10px;
    padding: 10px;
    border: 1px solid #ddd;
    max-height: 200px;
    overflow-y: auto;
    margin-top: 8px;
}

/* select Ù†ÙØ³Ù‡ */
#surahSelect {
    width: 100%;
    border: none;
    outline: none;
    font-size: 15px;
    font-family: "Cairo", Arial;
}

/* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª */
#surahSelect option {
    padding: 8px;
    border-radius: 6px;
    margin-bottom: 4px;
}

/* */
#surahSelect option:checked {
    background-color: #2e86de;
    color: white;
}

/* phone */
@media (max-width: 600px) {
    body {
        padding: 12px;
    }

    h2 {
        font-size: 20px;
        text-align: center;
    }

    button {
        width: 100%;
        margin-top: 10px;
        font-size: 16px;
    }

    .surah-box {
        max-height: 160px;
    }
}

    </style>
</head>

<body>

    <h2>ÙˆØ£Ø®Ø± Ù…ØªØ´Ø§Ø¨Ù‡Ø§Øª</h2>

<label>Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±:</label>

<button type="button" onclick="toggleSurahList()">
    Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ± ğŸ“œ
</button>

<div id="surahBox" class="surah-box" style="display:none;">
    <select id="surahSelect" multiple></select>
</div>

    <br><br>

    <label>Ø£Ù‚Ù„ Ø¹Ø¯Ø¯ ÙƒÙ„Ù…Ø§Øª:</label>
    <input type="number" id="minWords" value="3">

    <label>Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ ÙƒÙ„Ù…Ø§Øª:</label>
    <input type="number" id="maxWords" value="10">

    <br><br>

    <button onclick="searchOccurrences()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒÙˆÙŠØ²</button>
    <div id="quizBox" class="result" style="display:none; text-align:center;">
        <p id="phrase" style="font-size:18px; font-weight:bold; margin-bottom:10px;"></p>
        <p id="count" style="color:#555; margin-bottom:20px;"></p>

        <div style="display:flex; justify-content:center; gap:15px; flex-wrap:wrap; margin-bottom:15px;">
            <button onclick="showAnswer()" class="quiz-btn">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¬ÙˆØ§Ø¨</button>
            <button onclick="showSurahNames()" class="quiz-btn">Ø¹Ø±Ø¶ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø³ÙˆØ± ÙÙ‚Ø· ğŸ“œ</button>
        </div>

        <div id="answer" style="display:none; margin-top:15px; text-align:right;"></div>

        <button onclick="nextQuestion()" class="quiz-btn" style="margin-top:20px;">Ø§Ù„ØªØ§Ù„ÙŠ â­ï¸</button>
    </div>

    <style>
        .quiz-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            background-color: #2e86de;
            color: white;
            font-size: 15px;
            cursor: pointer;
            transition: 0.3s;
        }

        .quiz-btn:hover {
            background-color: #1b4f72;
        }

        /* Optional: make answer section look like a card */
        #answer p {
            background: #f1f3f6;
            padding: 8px 10px;
            border-radius: 6px;
            margin: 5px 0;
        }
    </style>


    <script src="quranData.js"></script>

    <script>
const defaultSurahs = [
  "ÙŠÙÙˆÙ†Ø³", "Ù‡ÙÙˆØ¯", "ÙŠÙÙˆØ³ÙÙ", "Ø§Ù„Ø±Ù‘ÙØ¹Ø¯", "Ø¥Ø¨Ø±Ø§Ù‡ÙÙŠÙ…", "Ø§Ù„Ø­ÙØ¬Ø±", "Ø§Ù„Ù†Ù‘ÙØ­Ù„",
  "Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡", "Ø§Ù„Ù†Ù‘ÙÙ…Ù„", "Ø§Ù„Ù‚ÙØµÙØµ", "Ø§Ù„Ø¹ÙÙ†ÙƒØ¨ÙÙˆØª", "Ø§Ù„Ø±Ù‘ÙÙˆÙ…", "Ù„ÙÙ‚Ù…ÙØ§Ù†",
  "Ø§Ù„Ø³Ù‘ÙØ¬Ø¯Ø©", "Ø§Ù„Ø£Ø­Ø²ÙØ§Ø¨", "Ù‚Ù“", "Ø§Ù„Ø°Ù‘ÙØ§Ø±ÙŠÙØ§Øª", "Ø§Ù„Ø·Ù‘ÙÙˆØ±", "Ø§Ù„Ù†Ù‘ÙØ¬Ù…", "Ø§Ù„Ù‚ÙÙ…ÙØ±",
  "Ø§Ù„Ø±Ù‘ÙØ­Ù…Ù°Ù†", "Ø§Ù„ÙˆÙØ§Ù‚ÙØ¹Ø©", "Ø§Ù„Ø­Ø¯ÙÙŠØ¯", "Ø§Ù„Ù…ÙØ¬ÙØ§Ø¯Ù„Ø©", "Ø§Ù„Ø­ÙØ´Ø±", "Ø§Ù„Ù…ÙÙ…ØªÙØ­Ù†ÙØ©",
  "Ø§Ù„ØµÙ‘ÙÙ", "Ø§Ù„Ø¬ÙÙ…Ø¹ÙØ©", "Ø§Ù„Ù…ÙÙ†ÙØ§ÙÙÙ‚ÙÙˆÙ†Ù", "Ø§Ù„ØªØºÙØ§Ø¨ÙÙ†", "Ø§Ù„Ø·Ù‘ÙÙ„ÙØ§Ù‚", "Ø§Ù„ØªÙ‘ÙØ­Ø±ÙÙŠÙ…",
  "Ø§Ù„Ù…ÙÙ„Ùƒ", "Ø§Ù„Ù‚ÙÙ„ÙÙ…", "Ø§Ù„Ø­ÙØ§Ù‚Ø©", "Ø§Ù„Ù…ÙØ¹ÙØ§Ø±Ø¬", "Ù†ÙÙˆØ­", "Ø§Ù„Ø¬ÙÙ†", "Ø§Ù„Ù…ÙØ²Ù…Ù„",
  "Ø§Ù„Ù…ÙØ¯Ø«Ø±", "Ø§Ù„Ù‚ÙÙŠÙØ§Ù…Ø©", "Ø§Ù„Ø¥Ù†Ø³ÙØ§Ù†", "Ø§Ù„Ù…ÙØ±Ø³ÙÙ„Ø§Øª", "Ø§Ù„Ù†Ù‘ÙØ¨ÙØ¥", "Ø§Ù„Ù†Ù‘ÙØ§Ø²Ø¹ÙØ§Øª",
  "Ø¹ÙØ¨ÙØ³Ù", "Ø§Ù„ØªÙ‘ÙÙƒÙˆÙŠØ±", "Ø§Ù„Ø§Ù†ÙÙØ·ÙØ§Ø±", "Ø§Ù„Ù…ÙØ·ÙÙÙÙŠÙ†", "Ø§Ù„Ø§Ù†Ø´ÙÙ‚ÙØ§Ù‚", "Ø§Ù„Ø¨ÙØ±ÙÙˆØ¬",
  "Ø§Ù„Ø·Ù‘ÙØ§Ø±Ù‚", "Ø§Ù„Ø£Ø¹Ù„Ù‰", "Ø§Ù„ØºÙØ§Ø´ÙÙŠØ©", "Ø§Ù„ÙÙØ¬Ø±", "Ø§Ù„Ø¨ÙÙ„ÙØ¯", "Ø§Ù„Ø´Ù‘ÙÙ…Ø³",
  "Ø§Ù„Ù„Ù‘ÙÙŠÙ„", "Ø§Ù„Ø¶Ù‘ÙØ­Ù‰",
  "Ø§Ù„Ù†Ù‘ÙØ§Ø³", "Ø§Ù„ÙÙÙ„ÙÙ‚", "Ø§Ù„Ø¥ÙØ®Ù’Ù„ÙØ§Øµ", "Ø§Ù„Ù…ÙØ³ÙØ¯", "Ø§Ù„Ù†Ù‘ÙØµÙ’Ø±", "Ø§Ù„ÙƒÙØ§ÙÙØ±ÙÙˆÙ†",
  "Ø§Ù„ÙƒÙÙˆÙ’Ø«ÙØ±", "Ø§Ù„Ø¹ÙØµÙ’Ø±", "Ø§Ù„Ù‡ÙÙ…ÙØ²ÙØ©", "Ø§Ù„ÙÙÙŠÙ„", "Ù‚ÙØ±ÙÙŠÙ’Ø´",
  "Ø§Ù„Ù…ÙØ§Ø¹ÙÙˆÙ†", "Ø§Ù„ØªÙ‘ÙÙƒÙØ§Ø«ÙØ±", "Ø§Ù„Ù‚ÙØ§Ø±ÙØ¹ÙØ©", "Ø§Ù„Ø¹ÙØ§Ø¯ÙÙŠÙØ§Øª", "Ø§Ù„Ø²Ù‘ÙÙ„Ù’Ø²ÙÙ„ÙØ©",
  "Ø§Ù„Ø¨ÙÙŠÙ‘ÙÙ†ÙØ©", "Ø§Ù„Ù‚ÙØ¯Ù’Ø±", "Ø§Ù„Ø¹ÙÙ„ÙÙ‚", "Ø§Ù„ØªÙ‘ÙÙŠÙ†", "Ø§Ù„Ø´Ù‘ÙØ±Ù’Ø­"
];

function toggleSurahList() {
    const box = document.getElementById("surahBox");
    box.style.display = box.style.display === "none" ? "block" : "none";
}


       let finalResults = [];
        let quizIndex = 0;
        function populateSurahSelect() {
            const surahSelect = document.getElementById('surahSelect');
            const surahSet = new Set();

            quranData.forEach(aya =>
                surahSet.add(aya.sura_name_ar.trim())
            );

            Array.from(surahSet).forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;

                if (defaultSurahs.includes(name)) {
                    option.selected = true;
                }

                surahSelect.appendChild(option);
            });
        }



        function searchOccurrences() {

            const selectedSurahs =
                Array.from(document.getElementById('surahSelect').selectedOptions)
                    .map(o => o.value);

            const minWords = parseInt(document.getElementById('minWords').value);
            const maxWords = parseInt(document.getElementById('maxWords').value);

            let filteredData = [];

            if (selectedSurahs.length > 0) {
                selectedSurahs.forEach(surahName => {
                    quranData.forEach(aya => {
                        if (aya.sura_name_ar.trim() === surahName) {
                            filteredData.push(aya);
                        }
                    });
                });
            } else {
                filteredData = quranData;
            }
            /*
                        const resultsMap = new Map();
                        const seenPhrases = new Map();
            
                        filteredData.forEach(aya => {
                            const words = aya.aya_text.trim().split(/\s+/);
            
                            for (let len = minWords; len <= maxWords; len++) {
                                /*    for (let i = 0; i <= words.length - len; i++) {
                                        // const phrase = words.slice(i, i + len).join(" ");
                                        // Ù†Ø£Ø®Ø° ÙÙ‚Ø· Ø¨Ø¯Ø§ÙŠØ© Ø£Ùˆ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¢ÙŠØ©
                                        const isAtStart = i === 0;
                                        const isAtEnd = i + len === words.length;
                
                
                                        if (!isAtStart && !isAtEnd) continue;
                
                                        const phrase = words.slice(i, i + len).join(" ");
                                        /*hnee youfa */
            /*const isAtStart = i === 0;
            const isAtEnd = i + len === words.length;

            // Ø´Ø±Ø·: Ø®Ø° Ø§Ù„ØªÙƒØ±Ø§Ø± ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø£Ùˆ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
            if (!isAtStart && !isAtEnd) continue;

            const phrase = words.slice(i, i + len).join(" ");

            // Ø§Ù„Ø¢Ù†: ÙƒÙ„ ØªÙƒØ±Ø§Ø± Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„Ø¢ÙŠØ© ÙŠØ¶Ø§Ù ÙƒÙ„ Ù…Ø±Ø©
            if (!resultsMap.has(phrase)) {
                resultsMap.set(phrase, []);
            }

            resultsMap.get(phrase).push({
                surah: aya.sura_name_ar,
                aya_no: aya.aya_no,
                text: aya.aya_text
            });

            if (!seenPhrases.has(phrase)) {
                seenPhrases.set(phrase, [{
                    surah: aya.sura_name_ar,
                    aya_no: aya.aya_no,
                    text: aya.aya_text
                }]);
            } else {
                if (!resultsMap.has(phrase)) {
                    resultsMap.set(phrase, [...seenPhrases.get(phrase)]);
                }

                resultsMap.get(phrase).push({
                    surah: aya.sura_name_ar,
                    aya_no: aya.aya_no,
                    text: aya.aya_text
                });
            }
        }



    });

    finalResults = [];

    resultsMap.forEach((occ, phrase) => {
        if (occ.length > 1) {
            finalResults.push({
                phrase,
                count: occ.length,
                occurrences: occ
            });
        }
    });
    // Ø®Ù„Ø· Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§
    finalResults.sort(() => Math.random() - 0.5);

    quizIndex = 0;
    document.getElementById("quizBox").style.display = "block";
    showQuestion();
}*/
            const resultsMap = new Map();

            for (let aya of filteredData) {
                const words = aya.aya_text.trim().split(/\s+/);

                for (let len = minWords; len <= maxWords; len++) {
                    for (let i = 0; i <= words.length - len; i++) {
                        const isAtStart = i === 0;
                        const isAtEnd = i + len === words.length;

                        // Ø´Ø±Ø·: Ø®Ø° Ø§Ù„ØªÙƒØ±Ø§Ø± ÙÙ‚Ø· ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø£Ùˆ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¢ÙŠØ©
                        if (!isAtStart && !isAtEnd) continue;

                        const phrase = words.slice(i, i + len).join(" ");

                        // ØªØ¬Ø§Ù‡Ù„ Ø¥Ø°Ø§ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† Ø­Ø±Ù ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·
                        if (phrase.length === 1) continue;

                        // ÙƒÙ„ ØªÙƒØ±Ø§Ø± ÙŠØ¶Ø§Ù
                        if (!resultsMap.has(phrase)) {
                            resultsMap.set(phrase, []);
                        }

                        resultsMap.get(phrase).push({
                            surah: aya.sura_name_ar,
                            aya_no: aya.aya_no,
                            text: aya.aya_text
                        });

                    }
                }
            }

            // Ø¨Ù†Ø§Ø¡ finalResults ÙÙ‚Ø· Ù„Ù„ØªÙƒØ±Ø§Ø±Ø§Øª (count > 1)
            finalResults = [];
            // Ø¨Ø¹Ø¯ Ø¨Ù†Ø§Ø¡ resultsMap
            finalResults = [];

            resultsMap.forEach((occ, phrase) => {
                if (occ.length > 1) {
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙƒØ¨Ø± Ù†Øµ Ù…Ø´ØªØ±Ùƒ Ø¨ÙŠÙ† ÙƒÙ„ occurrences
                    let commonText = occ[0].text;

                    for (let i = 1; i < occ.length; i++) {
                        commonText = longestCommonSubstring(commonText, occ[i].text);
                    }

                    // trim Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                    commonText = commonText.trim();

                    finalResults.push({
                        phrase: commonText, // Ø§Ø³ØªØ®Ø¯Ù… Ø£ÙƒØ¨Ø± Ù†Øµ Ù…Ø´ØªØ±Ùƒ
                        count: occ.length,
                        occurrences: occ
                    });
                }
            });

            // Ø®Ù„Ø· Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            finalResults.sort(() => Math.random() - 0.5);
            quizIndex = 0;
            document.getElementById("quizBox").style.display = "block";
            showQuestion();


            // ===== Ø¯Ø§Ù„Ø© Ù„Ø¥ÙŠØ¬Ø§Ø¯ Ø£ÙƒØ¨Ø± Ù†Øµ Ù…Ø´ØªØ±Ùƒ Ø¨ÙŠÙ† Ø³Ù„Ø³Ù„ØªÙŠÙ† =====
            function longestCommonSubstring(s1, s2) {
                let maxLen = 0;
                let endIndex = 0;

                for (let i = 0; i < s1.length; i++) {
                    for (let j = 0; j < s2.length; j++) {
                        let k = 0;
                        while (i + k < s1.length && j + k < s2.length && s1[i + k] === s2[j + k]) {
                            k++;
                        }
                        if (k > maxLen) {
                            maxLen = k;
                            endIndex = i + k;
                        }
                    }
                }
                return s1.substring(endIndex - maxLen, endIndex);
            }


            // Ø®Ù„Ø· Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§
            finalResults.sort(() => Math.random() - 0.5);

            quizIndex = 0;
            document.getElementById("quizBox").style.display = "block";
            showQuestion();
        }
        // ===== Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ =====
        function showQuestion() {
            const q = finalResults[quizIndex];

            document.getElementById("phrase").innerHTML =
                `<strong>Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©:</strong> ${q.phrase}`;

            document.getElementById("count").innerHTML =
                `<strong>Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„ØªÙƒØ±Ø§Ø±:</strong> ${q.count}`;

            document.getElementById("answer").style.display = "none";
            document.getElementById("answer").innerHTML = "";
        }

        // ===== Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¬ÙˆØ§Ø¨ =====
        function showAnswer() {
            const q = finalResults[quizIndex];
            const div = document.getElementById("answer");

            div.innerHTML = "";

            q.occurrences.forEach(o => {
                const p = document.createElement("p");
                p.textContent =
                    `ğŸ“– ${o.surah} â€” Ø§Ù„Ø¢ÙŠØ© ${o.aya_no} â†’ ${o.text}`;
                div.appendChild(p);
            });

            div.style.display = "block";
        }
        function showSurahNames() {
            const q = finalResults[quizIndex];
            const div = document.getElementById("answer");

            // Ø¬Ù…Ø¹ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø³ÙˆØ± Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±
            const surahSet = new Set();
            q.occurrences.forEach(o => surahSet.add(o.surah));

            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù€ Set Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© ÙˆØ¹Ø±Ø¶Ù‡Ø§
            const surahList = Array.from(surahSet).join(" â€” ");

            div.innerHTML = `<strong>Ø§Ù„Ø³ÙˆØ± Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØªÙƒØ±Ø§Ø±:</strong> ${surahList}`;
            div.style.display = "block";
        }

        // ===== Ø§Ù„ØªØ§Ù„ÙŠ =====
        function nextQuestion() {
            quizIndex++;

            if (quizIndex >= finalResults.length) {
                alert("ğŸŒ¸ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙƒÙˆÙŠØ²");
                quizIndex = 0;
            }

            showQuestion();
        }

        populateSurahSelect();
    </script>

</body>

</html>
